{{ define "content" }}
<div class="flex flex-row justify-between items-center w-full py-5">
  <h1 class="text-2xl p-5 font-bold">Instances</h1>

  <button
    class="btn btn-primary"
    onclick="new_modal.showModal()"
  >
    Create a new instance
  </button>
</div>

<div class="flex flex-row justify-between items-center w-full py-5">
  {{ template "flash" .messages }} 
</div>

{{ if .instances }}
<div class=":">
  <table class="table">
    <thead>
      <tr>
        <th class="text-left">Name</th>
        <th class="text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      {{ range .instances }}
      <tr>
        <td>{{ .Name }}</td>
        <td>
          <a
            href="/admin/instances/{{ .ID }}/edit"
            class="btn btn-sm"
          >Edit</a>

          <button 
            class="btn btn-sm btn-error" 
            data-id="{{ .ID }}"
            data-name="{{ .Name }}"
            onclick="confirmDelete()">
              Delete
          </button>
        </td>
      </tr>
      {{ end }}
    </tbody>
  </table>
</div>
{{ else }}
<p class="py-4">No instances to show.</p>
{{ end }} 

<dialog id="confirm_delete_modal" class="modal">
  <div class="modal-box prose">
    <h3 class="text-lg font-bold">Delete an instance</h3>
    <p class="py-4">You are about to delete an instance. Doing this will delete:</p>
    <ul>
      <li>all associated teams</li>
      <li>all associated locations</li>
      <li>all associated activities/scans</li>
    </ul>
    <p>To confirm, please type the name of the instance you want to delete: <code id="instance_name">instance</code></p>
    <form method="post" action="/admin/instances/delete">
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text">Instance name</span>
        </div>
        <input type="text" class="input input-bordered w-full" name="name" required/>
        <input type="hidden" name="id" value=""/>
      </label>
      <div class="modal-action">
        <button type="button" class="btn" onclick="confirm_delete_modal.close()">Nevermind</button>
        <button type="submit" class="btn btn-error">Delete</button>
      </div>
    </form>
  </div>
</dialog>

<dialog id="new_modal" class="modal">
  <div class="modal-box">
    <form method="post" action="/admin/instances/new">
      <h3 class="text-lg font-bold">Create a new instance</h3>
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text">What is the name of the new instance?</span>
        </div>
        <input type="text" class="input input-bordered w-full" name="name" required/>
      </label>
      <div class="modal-action">
        <button
          class="btn"
          type="button"
          onclick="new_modal.close()"
        > 
          Nevermind
        </button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</dialog>

<script>
// Delete modal
const confirm_delete_modal = document.getElementById('confirm_delete_modal');

function confirmDelete() {
  const id = event.target.dataset.id;
  const name = event.target.dataset.name;
  const instance_name = document.getElementById('instance_name');
  const form = confirm_delete_modal.querySelector('form');
  const input = form.querySelector('input[name="name"]');
  const hidden = form.querySelector('input[name="id"]');

  instance_name.textContent = name;
  input.value = '';
  hidden.value = id;

  confirm_delete_modal.showModal();
}

</script>
{{ end }}
