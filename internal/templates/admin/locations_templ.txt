<!-- Header --><div class=\"flex flex-col gap-3 md:flex-row justify-between items-center w-full p-5\"><h1 class=\"text-2xl font-bold\">Locations  <span class=\"badge badge-ghost\">
</span> <span class=\"htmx-indicator loading loading-dots loading-md text-info\">Updating</span></h1><span class=\"flex md:flex-row flex-wrap justify-center gap-5\">
<div class=\"join\"><a href=\"/admin/locations/qr-codes.zip\" class=\"btn btn-base btn-outline join-item mb-3 md:mb-0\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-image-down\"><path d=\"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21\"></path> <path d=\"m14 19 3 3v-5.5\"></path> <path d=\"m17 22 3-3\"></path> <circle cx=\"9\" cy=\"9\" r=\"2\"></circle></svg> QR codes</a> <a class=\"btn btn-base btn-outline join-item\" href=\"/admin/locations/posters.pdf\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-file-down\"><path d=\"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\"></path> <path d=\"M14 2v4a2 2 0 0 0 2 2h4\"></path> <path d=\"M12 18v-6\"></path> <path d=\"m9 15 3 3 3-3\"></path></svg> Posters</a></div>
<a href=\"/admin/locations/new\" hx-boost=\"true\" class=\"btn btn-secondary\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin-plus w-5 h-5\"><path d=\"M19.914 11.105A7.298 7.298 0 0 0 20 10a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 1.202 0 32 32 0 0 0 .824-.738\"></path><circle cx=\"12\" cy=\"10\" r=\"3\"></circle><path d=\"M16 18h6\"></path><path d=\"M19 15v6\"></path></svg> Add Location</a></span></div><!-- Locations list --><div class=\"px-5\"><form
 class=\"join join-vertical w-full shadow sortable\"
 class=\"join join-vertical w-full\"
 hx-post=\"/admin/locations/reorder\" hx-trigger=\"end\" hx-swap=\"none\" hx-indicator=\".htmx-indicator\">
<div class=\"flex flex-row justify-between items-center gap-3 bg-base-200 hover:bg-base-300 rounded-lg p-4 join-item\" data-order=\"
\"><div class=\"flex flex-row items-center gap-3 grow\"><!-- Drag handle -->
<div class=\"tooltip tooltip-right flex gap-3 cursor-move\" data-tip=\"Drag to reorder\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-grip-vertical\"><circle cx=\"9\" cy=\"12\" r=\"1\"></circle><circle cx=\"9\" cy=\"5\" r=\"1\"></circle><circle cx=\"9\" cy=\"19\" r=\"1\"></circle><circle cx=\"15\" cy=\"12\" r=\"1\"></circle><circle cx=\"15\" cy=\"5\" r=\"1\"></circle><circle cx=\"15\" cy=\"19\" r=\"1\"></circle></svg></div><input type=\"hidden\" name=\"location\" value=\"
\">
<!-- Marker icon -->
<span class=\"tooltip tooltip-right @7xl:tooltip-top cursor-help\" data-tip=\"Has coordinates\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin\"><path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z\"></path> <circle cx=\"12\" cy=\"10\" r=\"3\"></circle></svg></span>
<span class=\"tooltip tooltip-right @7xl:tooltip-top cursor-help\" data-tip=\"Unmapped location\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin-off tooltip\" data-tip=\"Location has no coordinates set\"><path d=\"M5.43 5.43A8.06 8.06 0 0 0 4 10c0 6 8 12 8 12a29.94 29.94 0 0 0 5-5\"></path> <path d=\"M19.18 13.52A8.66 8.66 0 0 0 20 10a8 8 0 0 0-8-8 7.88 7.88 0 0 0-3.52.82\"></path> <path d=\"M9.13 9.13A2.78 2.78 0 0 0 9 10a3 3 0 0 0 3 3 2.78 2.78 0 0 0 .87-.13\"></path> <path d=\"M14.9 9.25a3 3 0 0 0-2.15-2.16\"></path> <line x1=\"2\" x2=\"22\" y1=\"2\" y2=\"22\"></line></svg></span>
<!-- Clue indicator -->
<span class=\"tooltip text-neutral cursor-help\" data-tip=\"No clues\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-search-x\"><path d=\"m13.5 8.5-5 5\"></path><path d=\"m8.5 8.5 5 5\"></path><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><path d=\"m21 21-4.3-4.3\"></path></svg></span>
<span class=\"tooltip cursor-help\" data-tip=\"Has clues\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-search\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><path d=\"m21 21-4.3-4.3\"></path></svg></span>
<!-- Location code --><div class=\"badge badge-ghost basis-16 tooltip\" data-tip=\"Unique location code\"><code>
</code></div><!-- Location name --><a href=\"
\" class=\"link flex-grow\" hx-boost=\"true\" hx-swap=\"outerHTML\">
</a> 
<span class=\"badge\">
 pts</span>
</div></div>
</form></div><script>\nhtmx.onLoad(function(content) {\n    var sortables = content.querySelectorAll(\".sortable\");\n    for (var i = 0; i < sortables.length; i++) {\n      var sortable = sortables[i];\n      var sortableInstance = new Sortable(sortable, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: \".cursor-move\",\n\n          // Make the `.htmx-indicator` unsortable\n          filter: \".htmx-indicator\",\n          onMove: function (evt) {\n            return evt.related.className.indexOf('htmx-indicator') === -1;\n          },\n\n          // Disable sorting on the `end` event\n          onEnd: function (evt) {\n            this.option(\"disabled\", true);\n          }\n      });\n\n      // Re-enable sorting on the `htmx:afterSwap` event\n      sortable.addEventListener(\"htmx:afterSwap\", function() {\n        sortableInstance.option(\"disabled\", false);\n      });\n    }\n})\n</script>
<form class=\"flex flex-col gap-5 w-full p-5 max-w-2xl mx-auto\" method=\"post\" hx-post=\"/admin/locations/new\"><!-- Header --><div class=\"flex flex-col gap-3 md:flex-row justify-between items-center w-full\"><h1 class=\"text-2xl font-bold\">Add a location</h1><button type=\"submit\" class=\"btn btn-primary hidden md:inline-flex\">Save</button></div><div class=\"flex flex-col md:flex-row gap-3\"><label class=\"form-control w-full\"><div class=\"label\"><span class=\"label-text font-bold\">Location name</span></div><div class=\"input input-bordered flex items-center gap-2\"><input id=\"name\" name=\"name\" type=\"text\" placeholder=\"Location name\" class=\"grow text-ellipsis\" autocomplete=\"off\" required> <span id=\"marker-badge\" class=\"badge badge-neutral hidden\"></span></div></label> 
<label for=\"points\" class=\"form-control w-full\"><div class=\"label\"><span class=\"label-text font-bold\">Points</span></div><input type=\"number\" id=\"points\" name=\"points\" class=\"input input-bordered w-full\" value=\"10\" placeholder=\"Enter points\" required></label>
</div>
<div role=\"tablist\" class=\"tabs tabs-boxed font-bold\"><a id=\"new-marker-tab\" role=\"tab\"
 class=\"tab transition-colors\"
 class=\"tab transition-colors tab-active\"
 _=\"on click \n\t\t\t\tif I do not match .tab-active\n\t\t\t\t\tremove .tab-active from .tab-active\n\t\t\t\t\ttoggle .tab-active\n\t\t\t\t\tremove .hidden from #new-marker\n\t\t\t\t\tadd .hidden to #shared-marker\n\t\t\t\t\tremove .hidden from #marker-controls\n\t\t\t\t\tset &lt;input[name=marker]/&gt;&#39;s disabled to true\n\t\t\t\t\tset &lt;input[name=name]/&gt;&#39;s value to &#39;&#39;\n\t\t\t\t\tadd .hidden to #marker-badge\n\t\t\t\t\tset &lt;input[name=latitude]/&gt;&#39;s disabled to false\n\t\t\t\t\tset &lt;input[name=longitude]/&gt;&#39;s disabled to false\n\t\t\t\">New map marker</a> <a role=\"tab\" class=\"tab transition-colors group\" _=\"on click \n\t\t\t\tif I do not match .tab-active\n\t\t\t\t\tremove .tab-active from .tab-active\n\t\t\t\t\ttoggle .tab-active\n\t\t\t\t\tremove .hidden from #shared-marker\n\t\t\t\t\tremove .hidden from #marker-controls\n\t\t\t\t\tadd .hidden to #new-marker\n\t\t\t\t\tset &lt;input[name=marker]/&gt;&#39;s disabled to false\n\t\t\t\t\ttrigger change on #marker-code\n\t\t\t\t\tset &lt;input[name=latitude]/&gt;&#39;s disabled to false\n\t\t\t\t\tset &lt;input[name=longitude]/&gt;&#39;s disabled to false\n\t\t\t\">Shared map marker<div class=\"dropdown dropdown-end dropdown-hover\"><div tabindex=\"0\" role=\"button\" class=\"text-info\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-info w-4 h-4 ml-1 group-[.tab-active]:stroke-primary-content\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M12 16v-4\"></path><path d=\"M12 8h.01\"></path></svg></div><div tabindex=\"0\" class=\"card compact font-normal dropdown-content bg-base-200 text-base-content rounded-box z-20 w-64 shadow-lg text-start\"><div tabindex=\"0\" class=\"card-body\"><h2 class=\"card-title\">Shared markers</h2><p>Shared markers enable multiple games to use the same posters while showing different content.</p><p>This makes it possible to play overlapping games at the same time with different content and rules.</p></div></div></div></a> 
<a role=\"tab\" class=\"tab transition-colors tab-active group\" _=\"on click\n\t\t\t\t\t\t\tif I do not match .tab-active\n\t\t\t\t\t\t\t\tremove .tab-active from .tab-active\n\t\t\t\t\t\t\t\ttoggle .tab-active\n\t\t\t\t\t\t\t\tadd .hidden to #new-marker\n\t\t\t\t\t\t\t\tadd .hidden to #shared-marker\n\t\t\t\t\t\t\t\tadd .hidden to #marker-controls\n\t\t\t\t\t\t\t\tset &lt;input[name=marker]/&gt;&#39;s disabled to true\n\t\t\t\t\t\t\t\tset &lt;input[name=name]/&gt;&#39;s value to &#39;&#39;\n\t\t\t\t\t\t\t\tadd .hidden to #marker-badge\n\t\t\t\t\t\t\t\tset &lt;input[name=latitude]/&gt;&#39;s disabled to true\n\t\t\t\t\t\t\t\tset &lt;input[name=longitude]/&gt;&#39;s disabled to true\n\t\t\t\t\t\t\tend\n\t\t\t\t\t\tend\n\t\t\t\t\t\ton load if I match .tab-active\n\t\t\t\t\t\t\tadd .hidden to #new-marker\n\t\t\t\t\t\t\tadd .hidden to #shared-marker\n\t\t\t\t\t\t\tadd .hidden to #marker-controls\n\t\t\t\t\t\t\tset &lt;input[name=marker]/&gt;&#39;s disabled to true\n\t\t\t\t\t\t\tset &lt;input[name=name]/&gt;&#39;s value to &#39;&#39;\n\t\t\t\t\t\t\tadd .hidden to #marker-badge\n\t\t\t\t\t\t\tset &lt;input[name=latitude]/&gt;&#39;s disabled to true\n\t\t\t\t\t\t\tset &lt;input[name=longitude]/&gt;&#39;s disabled to true\n\t\t\t\t\t\tend\n\t\t\t\t\t\tend\n\t\t\t\t\t\t\">No map marker<div class=\"dropdown dropdown-end dropdown-hover\"><div tabindex=\"0\" role=\"button\" class=\"text-info\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-info w-4 h-4 ml-1 group-[.tab-active]:stroke-primary-content\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M12 16v-4\"></path><path d=\"M12 8h.01\"></path></svg></div><div tabindex=\"0\" class=\"card compact font-normal dropdown-content bg-base-200 text-base-content rounded-box z-20 w-64 shadow-lg text-start\"><div tabindex=\"0\" class=\"card-body\"><h2 class=\"card-title\">No map marker</h2><p>Use this for locations that don’t stay in one place or don’t need a map. For example, a book that moves in a library or a spot inside a tall building.</p></div></div></div></a>
</div>
<span class=\"neighbour-marker hidden\" data-location=\"
\" data-lat=\"
\" data-lng=\"
\"></span>
<div id=\"marker-controls\"><div id=\"new-marker\" class=\"flex flex-col gap-3\"><!-- Map --><div class=\"form-control\"><label class=\"\"><span class=\"label-text font-bold p-2 mb-2\">Add a new map marker</span><div id=\"geocoder\" class=\"geocoder mt-2\"></div></label></div></div><div id=\"shared-marker\" class=\"hidden flex flex-row gap-3\"><input type=\"hidden\" name=\"marker\" disabled><div class=\"form-control w-full\"><label class=\"\"><span class=\"label-text font-bold p-2 mb-2\">Share a location with another game</span></label> <select id=\"marker-code\" class=\"select select-bordered w-full mt-2\" _=\"on change\n\t\t\t\t\tset val to my value\n\t\t\t\t\tset &lt;input[name=name]/&gt;&#39;s value to &lt;option[value=${val}]/&gt;&#39;s text\n\t\t\t\t\tset &lt;input[name=marker]/&gt;&#39;s value to my value\n\t\t\t\t\tremove .hidden from #marker-badge\n\t\t\t\t\tset #marker-badge&#39;s textContent to my value\n\t\t\t\t\t\"><option disabled selected>Select a location</option> 
<option value=\"
\" data-code=\"
\" data-lat=\"
\" data-lng=\"
\" data-name=\"
\">
</option>
</select></div></div><div id=\"map-container\" class=\"relative w-full aspect-square h-96 rounded-lg shadow-lg\"><div id=\"map\" class=\"map w-full h-full rounded-lg\"></div></div><input type=\"hidden\" name=\"latitude\"> <input type=\"hidden\" name=\"longitude\"></div><button type=\"submit\" class=\"btn btn-primary\">Save</button></form>
<!-- Header --><div class=\"flex flex-col sm:flex-row gap-3 justify-between items-center w-full p-5\"><h1 class=\"text-2xl font-bold\">Editing <em>
</em></h1><div class=\"flex gap-3\"><div class=\"dropdown\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-outline\">Download <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-chevron-down w-4 h-4\"><path d=\"m6 9 6 6 6-6\"></path></svg></div><ul tabindex=\"0\" class=\"dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow\"><h2 class=\"menu-title\">Pre-made</h2><li><ul><li><a href=\"
\">
Posters (PDF)
Poster (PDF)
</a></li></ul></li><h2 class=\"menu-title\">Check-In</h2><li><ul><li><a href=\"
\" download=\"
\">QR Code (PNG)</a></li><li><a href=\"
\" download=\"
\">QR Code (SVG)</a></li></ul></li>
<h2 class=\"menu-title\">Check-Out</h2><li><ul><li><a href=\"
\" download=\"
\">QR Code (PNG)</a></li><li><a href=\"
\" download=\"
\">QR Code (SVG)</a></li></ul></li>
</ul></div><button type=\"button\" class=\"btn btn-error\" onclick=\"confirm_delete_modal.showModal();\">Delete</button> <button id=\"edit-location-btn\" class=\"btn btn-primary\" hx-post=\"
\" hx-swap=\"none\" hx-include=\"[form=edit-location]\" hx-trigger=\"click, keyup changed from:[form=edit-location] delay:500ms\">Save</button></div></div><div class=\"flex-grow mx-auto\"><div class=\"flex flex-col md:flex-row p-5 pt-0 gap-5\"><div class=\"flex flex-col flex-grow\"><div class=\"flex flex-col sm:flex-row gap-5 mb-5\"><!-- Location Title --><label for=\"name\" class=\"form-control w-full md:w-1/2\"><div class=\"label\"><span class=\"label-text font-bold\">Location name</span></div><input type=\"text\" id=\"name\" name=\"name\" form=\"edit-location\" class=\"input input-bordered w-full\" value=\"
\" placeholder=\"Location name\"></label> 
<!-- Location Points --> <label for=\"points\" class=\"form-control w-full md:w-1/2\"><div class=\"label\"><span class=\"label-text font-bold\">Points</span> 
<span class=\"label-text-alt\"><span class=\"flex gap-1 badge badge-outline badge-sm tooltip cursor-help\" data-tip=\"Points are currently disabled\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-info w-3 h-3\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M12 16v-4\"></path><path d=\"M12 8h.01\"></path></svg> Disabled</span></span>
</div><input type=\"number\" id=\"points\" name=\"points\" form=\"edit-location\" class=\"input input-bordered w-full\" value=\"
\" placeholder=\"Enter points\"></label>
<input type=\"hidden\" name=\"points\" value=\"
\">
</div><!-- Clues -->
<section class=\"mb-8\"><div class=\"label flex justify-between\"><div class=\"flex flex-row-reverse justify-end md:justify-start md:flex-row\"><strong>Clues</strong><div class=\"dropdown dropdown-hover\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-circle btn-ghost btn-xs text-info\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-circle-alert w-4 h-4 text-info\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" x2=\"12\" y1=\"8\" y2=\"12\"></line><line x1=\"12\" x2=\"12.01\" y1=\"16\" y2=\"16\"></line></svg></div><div tabindex=\"0\" class=\"card compact dropdown-content bg-base-200 rounded-box z-[1] w-64 shadow\"><div tabindex=\"0\" class=\"card-body\"><h2 class=\"card-title\">Clues</h2><p class=\"text-wrap\">Each team is shown one randomly selected clue.</p><p class=\"text-wrap\">If no clues are available then the player is told the name of the location as a freebie.</p><p class=\"text-wrap\">Clues may contain <a class=\"link\" href=\"/docs/user/markdown-guide\" target=\"blank\">Markdown</a> formatting.</p></div></div></div></div><button class=\"add-clue-btn btn btn-sm btn-neutral my-2\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list-plus w-5 h-5\"><path d=\"M11 12H3\"></path><path d=\"M16 6H3\"></path><path d=\"M16 18H3\"></path><path d=\"M18 9v6\"></path><path d=\"M21 12h-6\"></path></svg> Add a clue</button></div><div id=\"clue-list\" class=\"flex flex-col join join-vertical\">
<div class=\"alert\"><span>There are no clues to show. Do you want to <a class=\"link add-clue-btn\">add a clue</a>? </span></div>
<label class=\"clue-line input input-bordered bg-transparent flex flex-row items-top gap-2 h-auto join-item\" data-item-id=\"
\"><input type=\"text\" name=\"clues\" form=\"edit-location\" class=\"w-full input hover:border-0 hover:outline-0 focus:border-0 focus:outline-0 border-0 outline-0 pr-8 pl-0 bg-transparent overflow-ellipsis\" value=\"
\" placeholder=\"Add a clue\" autoComplete=\"off\"> <input type=\"hidden\" name=\"clue-ids\" value=\"
\"> <button type=\"button\" class=\"btn btn-xs btn-circle hover:btn-error tooltip tooltip-left flex mt-3\" data-tip=\"Delete\" onclick=\"this.closest(&#39;.clue-line&#39;).remove()\" tabindex=\"-1\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-trash-2 w-3 h-3\"><path d=\"M3 6h18\"></path><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path><line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"></line><line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"></line></svg></button></label>
</div></section>
<!-- Blocks --><section><div class=\"divider mt-5 mb-10\"><div class=\"dropdown\"><div class=\"block\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-sm btn-neutral w-32 flex flex-col\"><svg class=\"w-5 h-5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-plus\"><path d=\"M5 12h14\"></path><path d=\"M12 5v14\"></path></svg> Add content</div></div><div tabindex=\"0\" class=\"dropdown-content card bg-base-200 border border-base-300 shadow-lg w-96 -ml-24 mt-3 z-50\"><div class=\"card-body\"><h2 class=\"card-title mb-3\">Add content</h2><div class=\"grid grid-cols-3 grid-flow-row gap-5\">
<div class=\"indicator w-full\">
<span class=\"indicator-item indicator-top indicator-center badge badge-outline border-base-content/30 bg-base-100\">Interactive</span>
<div class=\"btn btn-outline border-base-content/30 h-auto p-3 tooltip flex flex-col gap-1 items-center rounded-md w-full\" data-tip=\"
\" hx-post=\"
\" hx-target=\"#blocks\" hx-swap=\"beforeend\">
</div></div>
</div></div></div></div></div><div id=\"blocks\" class=\"flex flex-col gap-5\">
</div></section><!-- Map -->
<section><div class=\"divider mt-5 mb-10\"></div><div class=\"label\"><span class=\"label-text font-bold\">Map marker</span></div><div id=\"map-container\" class=\"relative w-full aspect-square h-80 md:h-48 rounded-lg shadow-lg\"><div id=\"map\" class=\"map w-full h-full rounded-lg\"></div><!-- Overlay Button and Backdrop --><div id=\"map-lock-overlay\" class=\"absolute inset-0 bg-base-300 bg-opacity-70 flex justify-center items-center opacity-0 hover:opacity-100 transition rounded-lg focus:opacity-100\" tabindex=\"0\"><button id=\"unlock-map-btn\" class=\"btn btn-neutral\" _=\"on click\n\t\t\t\t\t\t\t\t\tremove #map-lock-overlay then\n\t\t\t\t\t\t\t\t\ttransition #map-note&#39;s opacity to 1\n\t\t\t\t\t\t\t\t\t\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-lock-keyhole w-5 h-5\"><circle cx=\"12\" cy=\"16\" r=\"1\"></circle><rect x=\"3\" y=\"10\" width=\"18\" height=\"12\" rx=\"2\"></rect><path d=\"M7 10V7a5 5 0 0 1 10 0v3\"></path></svg> Unlock to edit</button></div></div><div id=\"map-note\" class=\"label opacity-0\"><span class=\"label-text\"><strong>Note:</strong> Changing the map marker might change the location code.</span> <span class=\"label-text\">Autosave is disabled for map markers.</span></div><!-- Hidden inputs for form handling --><input type=\"hidden\" name=\"code\" form=\"edit-location\" value=\"
\"> <input type=\"hidden\" name=\"latitude\" form=\"edit-location\" value=\"
\"> <input type=\"hidden\" name=\"longitude\" form=\"edit-location\" value=\"
\"></section>
</div><!-- Sidebar --><!-- Preview Divider --><div class=\"divider lg:divider-horizontal px-5\"><div class=\"divider-text\">Preview</div></div><!-- Preview --><div class=\"flex h-min-content flex-col\"><div class=\"mockup-phone h-min sticky top-8\"><div class=\"camera\"></div><div class=\"display\"><div class=\"artboard artboard-demo phone lg:phone-2\" data-theme=\"cupcake\"><!-- Demo --><div class=\"sm:mx-auto sm:w-full sm:max-w-sm block overflow-y-scroll p-5 py-12\" hx-get=\"
\" hx-trigger=\"load, htmx:afterRequest from:#blocks, htmx:afterRequest from:#edit-location-btn, htmx:afterRequest from:#delete-block-btn\" hx-vals=\"
\" hx-swap=\"innerHTML\" hx-indicator=\".htmx-indicator\"></div><!-- /Demo --></div></div></div></div></div></div><dialog id=\"confirm_delete_block\" class=\"modal\"><div class=\"modal-box prose outline outline-2 outline-offset-1 outline-error\"><h3 class=\"text-lg font-bold\">Delete this block?</h3><p class=\"pt-4\">You are about to delete this block. Are you sure?</p><div class=\"modal-action\"><button type=\"button\" class=\"btn\" onclick=\"confirm_delete_block.close()\">Nevermind</button> <button id=\"delete-block-btn\" type=\"button\" class=\"btn btn-error\" onclick=\"confirm_delete_block.close()\">Delete</button></div></div></dialog> <dialog id=\"confirm_delete_modal\" class=\"modal\"><div class=\"modal-box prose outline outline-2 outline-offset-1 outline-error\"><h3 class=\"text-lg font-bold\">Delete this location?</h3><p class=\"pt-4\">You are about to delete this location. Are you sure?</p><div class=\"modal-action\"><button type=\"button\" class=\"btn\" onclick=\"confirm_delete_modal.close()\">Nevermind</button> <button type=\"button\" class=\"btn btn-error\" hx-delete=\"
\" hx-trigger=\"click\" onclick=\"confirm_delete_modal.close()\">Delete</button></div></div></dialog><script>\n    function moveblock(event, direction) {\n        event.preventDefault();\n        const block = event.target.closest('.content-block');\n        if (block) {\n            let sibling;\n            if (direction === 'up') {\n                sibling = block.previousElementSibling;\n            } else if (direction === 'down') {\n                sibling = block.nextElementSibling;\n            }\n\n            if (sibling && sibling.classList.contains('content-block')) {\n                // Calculate the height of the sibling plus the gap (20px for Tailwind gap-5)\n                const blockHeight = block.offsetHeight;\n                const siblingHeight = sibling.offsetHeight;\n                const gap = 20; // gap-5 in pixels\n\n                // Apply a relative position and initial offset for a smooth transition\n                block.style.position = 'relative';\n                sibling.style.position = 'relative';\n                \n                if (direction === 'up') {\n                    block.style.transform = `translateY(-${siblingHeight + gap}px)`;\n                    sibling.style.transform = `translateY(${blockHeight + gap}px)`;\n                } else {\n                    block.style.transform = `translateY(${siblingHeight + gap}px)`;\n                    sibling.style.transform = `translateY(-${blockHeight + gap}px)`;\n                }\n\n                // Trigger reflow to apply the animation\n                requestAnimationFrame(() => {\n                    block.classList.add('transitioning');\n                    sibling.classList.add('transitioning');\n\n                    // Reset transforms and swap elements after animation duration\n                    setTimeout(() => {\n                        block.style.transform = '';\n                        sibling.style.transform = '';\n                        block.classList.remove('transitioning');\n                        sibling.classList.remove('transitioning');\n                        \n                        block.style.position = '';\n                        sibling.style.position = '';\n                        \n                        block.parentNode.insertBefore(\n                            direction === 'up' ? block : sibling,\n                            direction === 'up' ? sibling : block\n                        );\n                    }, 300);\n                });\n            }\n        }\n    }\n</script><style>\n    .transitioning {\n        transition: transform 0.3s ease;\n    }\n</style><script>\n(() => {\n  const addClueBtns = document.querySelectorAll(\".add-clue-btn\");\n  const clueList = document.getElementById(\"clue-list\");\n  let alertRemoved = false; // Tracks if the alert has been removed\n\n  addClueBtns.forEach((btn) => {\n    btn.addEventListener(\"click\", function () {\n      // Remove the alert if present and not already removed\n      if (!alertRemoved) {\n        const existingAlert = clueList.querySelector(\".alert\");\n        if (existingAlert) {\n          existingAlert.remove();\n        }\n        alertRemoved = true; // Mark that alert has been removed\n      }\n\n      // Create the new clue input element based on the provided template\n      addNewClueField();\n    });\n  });\n\n  // Function to create and add a new clue field to the list\n  const addNewClueField = (value = \"\") => {\n    const newClueLine = document.createElement(\"label\");\n    newClueLine.classList.add(\n      \"clue-line\", \"input\", \"input-bordered\", \"bg-transparent\", \"flex\", \"flex-row\", \"items-top\", \"gap-2\", \"h-auto\", \"join-item\"\n    );\n\n    newClueLine.innerHTML = `\n      <input\n        type=\"text\"\n        name=\"clues\"\n        class=\"w-full input hover:border-0 hover:outline-0 focus:border-0 focus:outline-0 border-0 outline-0 pr-8 pl-0 bg-transparent overflow-ellipsis\"\n        placeholder=\"Add a clue\"\n        autoComplete=\"off\"\n        value=\"${value}\"\n      />\n      <button\n        type=\"button\"\n        class=\"btn btn-xs btn-circle hover:btn-error tooltip tooltip-left flex mt-3\"\n        data-tip=\"Delete\"\n        onclick=\"this.closest('.clue-line').remove()\"\n        tabindex=\"-1\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-trash-2 w-3 h-3\"><path d=\"M3 6h18\"></path><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path><line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"></line><line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"></line></svg>\n      </button>\n    `;\n\n    // Add paste event to handle multi-line input\n    const inputField = newClueLine.querySelector('input[type=\"text\"]');\n    inputField.addEventListener(\"paste\", handlePasteEvent);\n\n    // Append the new clue line to the clue list\n    clueList.appendChild(newClueLine);\n  };\n\n  // Event handler for paste event\n  const handlePasteEvent = (event) => {\n    event.preventDefault(); // Prevent default paste behavior\n    const pasteData = (event.clipboardData || window.clipboardData).getData(\"text\");\n    const lines = pasteData.split(\"\\n\").filter(line => line.trim() !== \"\"); // Split and remove empty lines\n\n    // If only one line, just paste into the current field\n    if (lines.length === 1) {\n      event.target.value = lines[0];\n    } else {\n      // Otherwise, split lines into separate clue fields\n      event.target.value = lines[0]; // Set the first line to the current input\n      for (let i = 1; i < lines.length; i++) {\n        addNewClueField(lines[i]); // Create a new clue input for each additional line\n      }\n    }\n  };\n})();\n</script>
<script>\n(function () {\n  let map; \n  let marker;\n\n  function initializeMap() {\n    let coords = [174.0710596, -40.9664536];\n    let zoom = 4;\n\n    // Check if longitude and latitude fields are set\n    if (document.querySelector('input[name=\"longitude\"]').value !== \"\" &&\n        document.querySelector('input[name=\"latitude\"]').value !== \"\") {\n      coords = [\n        parseFloat(document.querySelector('input[name=\"longitude\"]').value),\n        parseFloat(document.querySelector('input[name=\"latitude\"]').value)\n      ];\n      zoom = 16;\n    }\n\n    // Destroy existing map instance if it exists\n    if (map) {\n      map.remove();\n      map = null; // Explicitly set to null to clear reference\n    }\n\n    // Set the Mapbox access token\n    mapboxgl.accessToken = document.getElementById('mapbox_key').dataset.key;\n\n    // Determine map style based on color scheme\n    const style = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n      ? 'mapbox://styles/nathanhollows/cl9w3nxff002m14sy9fco4vnr'\n      : 'mapbox://styles/nathanhollows/clszboe2y005i01oid8ca37jm';\n\n    // Create the map\n    map = new mapboxgl.Map({\n      container: 'map',\n      style: style,\n      center: coords,\n      zoom: zoom\n    });\n\n    // Create and place the main marker\n    marker = new mapboxgl.Marker()\n      .setLngLat(coords)\n      .addTo(map);\n\n    // Update marker position on map drag\n    map.on('move', function() {\n      const center = map.getCenter();\n      marker.setLngLat(center);\n      document.querySelector('input[name=\"latitude\"]').value = center.lat;\n      document.querySelector('input[name=\"longitude\"]').value = center.lng;\n    });\n\n    // Update marker position on map zoom\n    map.on('zoom', function() {\n      const center = map.getCenter();\n      marker.setLngLat(center);\n    });\n\n    // Handle select change event\n    const locationSelect = document.getElementById('marker-code');\n    if (locationSelect) {\n      locationSelect.addEventListener('change', function (event) {\n        const selectedOption = event.target.options[event.target.selectedIndex];\n        const lat = parseFloat(selectedOption.dataset.lat);\n        const lng = parseFloat(selectedOption.dataset.lng);\n\n        if (!isNaN(lat) && !isNaN(lng)) {\n          // Update the map center and marker position\n          map.flyTo({ center: [lng, lat], zoom: 16 });\n          marker.setLngLat([lng, lat]);\n\n          // Disable dragging on the map\n          map.dragPan.disable();\n          map.scrollZoom.disable();\n\n          // Update latitude and longitude fields\n          document.querySelector('input[name=\"latitude\"]').value = lat;\n          document.querySelector('input[name=\"longitude\"]').value = lng;\n        }\n      });\n    }\n\n    // Re-enable map dragging when new marker tab is clicked\n    const newMarkerTab = document.getElementById('new-marker-tab');\n    if (newMarkerTab) {\n      newMarkerTab.addEventListener('click', function () {\n        map.dragPan.enable();\n        map.scrollZoom.enable();\n      });\n    }\n\n\t\t// Check for .neighbour-marker elements\n\t\tconst neighborMarkers = document.querySelectorAll('.neighbour-marker');\n\t\tif (neighborMarkers.length > 0) {\n\t\t\t// Fit to bounding box of all neighbor markers with a max zoom of 14\n\t\t\tlet bounds = new mapboxgl.LngLatBounds();\n\t\t\tneighborMarkers.forEach(elem => {\n\t\t\t\tconst lat = parseFloat(elem.dataset.lat);\n\t\t\t\tconst lng = parseFloat(elem.dataset.lng);\n\t\t\t\tif (!isNaN(lat) && !isNaN(lng)) {\n\t\t\t\t\tbounds.extend([lng, lat]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmap.fitBounds(bounds, { padding: 14, duration: 0 });\n\t\t}\n\n    var geocoderEl = document.getElementById('geocoder');\n    if (geocoderEl) {\n      var geocoder = new MapboxGeocoder({\n        accessToken: mapboxgl.accessToken,\n        mapboxgl: mapboxgl,\n        marker: false,\n        placeholder: 'Search for an address or use the map',\n      });\n      geocoderEl.appendChild(geocoder.onAdd(map));\n    }\n  }\n\n  // Delete block confirmation dialog\n  function confirmDeleteBlock(event) {\n    modal = document.getElementById(\"confirm_delete_block\");\n    url = \"/admin/locations/\" + event.currentTarget.dataset.location + \"/blocks/\" + event.currentTarget.dataset.block + \"/delete\";\n    btn = modal.querySelector(\"button.btn-error\")\n    btn.setAttribute(\"hx-delete\", url);\n    btn.setAttribute(\"hx-swap\", \"outerHTML\");\n    btn.setAttribute(\"hx-target\", \"#\" + event.target.closest(\".content-block\").id);\n    modal.showModal();\n    htmx.process(modal);\n  }\n\n  for (const element of document.querySelectorAll('.block-delete')) {\n    element.addEventListener('click', confirmDeleteBlock);\n  }\n\n  // Add listener to #blocks for new blocks\n  if (document.getElementById(\"blocks\")) {\n    document.getElementById(\"blocks\").addEventListener(\"htmx:afterSwap\", function (event) {\n      for (const element of document.querySelectorAll('.block-delete')) {\n        element.addEventListener('click', confirmDeleteBlock);\n      }\n    });\n  }\n\n  initializeMap();\n})();\n</script>
